<!DOCTYPE html>
<html>
<head>
    <title>MusicPlayer</title>
	<link rel="stylesheet" type="text/css" href="ui_elements.css">
</head>

<script>
var g_player = null;	

//------------------------------------------
//
//------------------------------------------
function OnOffCtrl(parent, id, text)
{
	var ctrl = document.createElement("span");
	parent.appendChild(ctrl);

	ctrl.innerText = text;	
	
	//...
	fileNameCtrl
	fileNameCtrl.owner = ctrl;

	
	ctrl.SetOn = function(isOn)
	{
		this.isOn = isOn;
		if(this.isOn) this.className = "OnOffCtrlStyle_On";
		else this.className = "OnOffCtrlStyle_Off";
	}
	
	ctrl.onclick = function()
	{
		this.SetOn(!this.isOn);
	}

	ctrl.SetOn(false);
	
	return ctrl;
}

//------------------------------------------
//
//------------------------------------------
function CreateFileListControl(parent, id)
{
	var ctrl = document.createElement("span");
	parent.appendChild(ctrl);
	
	ctrl.addElement = function(name, userData)
	{
		var div_file = document.createElement("div");
		this.appendChild(div_file);
		
		div_file.innerText = name;
		div_file.userData = userData;
		div_file.owner = ctrl;
		
		div_file.className = "fileListElementStyle";
		div_file.onclick = function() {
			this.owner.setSelection(this);
		}
	};
	
	ctrl.addHeader = function(name)
	{
		var div_header = document.createElement("div");
		this.appendChild(div_header);
		
		div_header.innerText = name;
		div_header.owner = ctrl;
		div_header.className = "fileListHeaderStyle";
	};
	
	// Clears all elements (headers and files), leaving the control empty.
	ctrl.clearAll = function()
	{
		this.innerHTML = "";
	};
	
	// Explores a directory and creates elements in the same hierarchy.
	ctrl.exploreDirectory = function(dir) {
		
		// Clear the current state.
		this.clearAll();
		this.exploreDirectoryRecursive(dir);
	}
	
	ctrl.exploreDirectoryRecursive = function(dir) {
		var fs = require('fs');

		// Recursively explore the directory tree.
		var contents = fs.readdirSync(dir);
	
		for(var t = 0; t < contents.length; ++t) {
			var fileName =  contents[t];
			var path = dir + "/" + fileName;
			
			var isDirectory = fs.lstatSync(path).isDirectory();	
			if(isDirectory)
			{
				this.addHeader(path);
				this.exploreDirectoryRecursive(path);
			}
			else
			{
				// the userdata (second arg) in the full path to the file.
				this.addElement(fileName, path);
			}
		}
	};
	
	// Handles the element selection.
	ctrl.currentlySelectedElem = null; // By default nothing is selected.
	
	// Updates the currently selected element. 
	// @elem - the html element being selected.
	ctrl.setSelection = function(elem)
	{
		if(elem != this.currentlySelectedElem)
		{	
			// Update the style of the old and the new selected elements.
			if(this.currentlySelectedElem) this.currentlySelectedElem.className = "fileListElementStyle";
			if(elem) elem.className = "fileListElementClicked";
			
			// Cache the currently selected element.
			this.currentlySelectedElem = elem;
			
			// Invoke the user callback when the selectiong is changed.
			if(this.onSelectionChanged) this.onSelectionChanged(elem);
		}
		
	};
	
	return ctrl;
}


//------------------------------------------
//
//------------------------------------------

function  findFilesDir(dir, result) {
	fs = require('fs');

	var contents = fs.readdirSync(dir);
	
	for(var t = 0; t < contents.length; ++t) {
		var path = dir + "/" + contents[t];
		var isDirectory = fs.lstatSync(path).isDirectory();	
		if(!isDirectory) result.push(path);
		else findFilesDir(path, result);
	}
}

function onPageReady( )
{
	var files2display = new Array();
	findFilesDir("./songs/", files2display);
	
	var ctrl = CreateFileListControl(document.getElementById("container"), "availableSongs");
	ctrl.exploreDirectory("D:/Music/");
	
	ctrl.onSelectionChanged = function(elem) {
		var audio = document.getElementById("audiotag_player");
		audio.setAttribute("src", elem.userData);
		audio.play();
	}
}
</script>

<script type="text/javascript" src="audiocontext.js"></script>

<body onLoad="onPageReady()">


<audio id="audiotag_player" controls>
</audio>

<span id = "Repeat"></span>
<span id = "Shuffle"></span>
<span id = "gergana"></span>
<div id = "container" style="width: 300px; display: block;"></div>
<div id = "soundScroll" style="position: relative"></div>
</br>

<div id = "soundScroll2" style="position: absolute; left: 100px"></div>

	
</body>
</html>
